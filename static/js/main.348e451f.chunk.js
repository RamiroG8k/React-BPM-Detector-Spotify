(this["webpackJsonptt-web"]=this["webpackJsonptt-web"]||[]).push([[0],{11:function(e,t,n){"use strict";n.r(t);var r=n(1),o=n.n(r),s=n(4),c=n.n(s),a=(n(9),n(2)),i=function(){var e="https://api.spotify.com/v1",t=null,n=function(e,t,n){var s={},c=null;return"object"===typeof t?(s=t,c=n):"function"===typeof t&&(c=t),o(e.params,s),r(e,c)},r=function(e,n){var r=function(r,o){var c=new XMLHttpRequest,a=e.type||"GET";"GET"===a?c.open(a,s(e.url,e.params),!0):c.open(a,s(e.url)),t&&c.setRequestHeader("Authorization","Bearer "+t),c.onreadystatechange=function(){if(4===c.readyState){var e=null;try{e=c.responseText?JSON.parse(c.responseText):""}catch(t){}200===c.status||201===c.status?(r&&r(e),n&&n(null,e)):(o&&o(c),n&&n(c,null))}},"GET"===a?c.send(null):c.send(JSON.stringify(e.postData))};return n?(r(),null):function(e){return new window.Promise(e)}(r)},o=function(){var e=Array.prototype.slice.call(arguments),t=e[0],n=e.slice(1);t=t||{};for(var r=0;r<n.length;r++)for(var o in n[r])t[o]=n[r][o];return t},s=function(e,t){var n="";for(var r in t)if(t.hasOwnProperty(r)){var o=t[r];n+=encodeURIComponent(r)+"="+encodeURIComponent(o)+"&"}return n.length>0&&(e=e+"?"+(n=n.substring(0,n.length-1))),e},c=function(){};return(c.prototype={constructor:i}).setAccessToken=function(e){t=e},c.prototype.searchTracks=function(t,r,o){return n({url:e+"/search/",params:{q:t,type:"track"}},r,o)},c.prototype.getAudioFeaturesForTrack=function(t,r){return n({url:e+"/audio-features/"+t},{},r)},c.prototype.getToken=function(e){return n({url:"https://spotify-web-api-token.herokuapp.com/token"},{},e)},c}();var u=n(0),l=function(){var e=Object(r.useState)(""),t=Object(a.a)(e,2),n=t[0],o=t[1],s=Object(r.useState)({}),c=Object(a.a)(s,2),l=c[0],p=c[1],f=Object(r.useState)(!1),d=Object(a.a)(f,2),m=d[0],h=d[1],b=Object(r.useRef)(),g=new i;g.getToken().then((function(e){g.setAccessToken(e.token)}));function j(){var e=document.querySelector("#progress");e.style.width="3px",e.style.fill="white",b.current.paused||(e&&b.current.duration&&e.setAttribute("x",100*b.current.currentTime/b.current.duration+"%"),requestAnimationFrame(j))}var v=function(){return Object(u.jsxs)(u.Fragment,{children:[Object(u.jsxs)("div",{className:"text-lg sm:text-xl",children:[Object(u.jsxs)("div",{children:["Guess for track ",Object(u.jsx)("strong",{children:l.track.name})," by ",Object(u.jsx)("strong",{children:l.track.artists[0].name})," is ",Object(u.jsxs)("strong",{children:[Math.round(l.top[0].tempo)," BPM"]})," with ",l.top[0].count," samples."]}),Object(u.jsxs)("div",{class:"small",children:["Other options are [",l.top.slice(1).map((function(e){return e.tempo+" BPM ("+e.count+")"})).join(", "),"]"]})]}),Object(u.jsxs)("div",{class:"small",children:["The tempo according to Spotify is ",Object(u.jsxs)("strong",{children:[l.tempo," BPM"]})]})]})};return Object(u.jsxs)("section",{className:"p-10 sm:py-10 sm:px-36 h-screen w-screen bg-gray-700 justify-center items-center",children:[Object(u.jsxs)("div",{className:"text-center sm:my-10",children:[Object(u.jsx)("h1",{className:"text-4xl sm:text-5xl font-bold text-gray-400 my-3",children:"Finding out the BPM of a song using Javascript"}),Object(u.jsxs)("p",{className:"text-lg leading-tight sm:text-2xl text-gray-900 font-semibold",children:["This demo uses the browser's ",Object(u.jsx)("strong",{children:"Audio API"})," to determine the tempo of a song, processing a chunk of 30 seconds of a song."]})]}),Object(u.jsxs)("form",{onSubmit:function(e){e.preventDefault(),g.searchTracks(e.target.song.value.trim(),{limit:1}).then((function(e){var t=e.tracks.items[0],n=t.preview_url;o(t.preview_url);var r=new XMLHttpRequest;r.open("GET",n,!0),r.responseType="arraybuffer",r.onload=function(){var e=new(window.OfflineAudioContext||window.webkitOfflineAudioContext)(2,1323e3,44100);e.decodeAudioData(r.response,(function(t){var n=e.createBufferSource();n.buffer=t;var r=e.createBiquadFilter();r.type="lowpass",r.frequency.value=150,r.Q.value=1,n.connect(r);var o=e.createBiquadFilter();o.type="highpass",o.frequency.value=100,o.Q.value=1,r.connect(o),o.connect(e.destination),n.start(0),e.startRendering()})),e.oncomplete=function(e){var n=e.renderedBuffer,r=function(e){for(var t=22050,n=e[0].length/t,r=[],o=0;o<n;o++){for(var s=0,c=o*t;c<(o+1)*t;c++){var a=Math.max(Math.abs(e[0][c]),Math.abs(e[1][c]));(!s||a>s.volume)&&(s={position:c,volume:a})}r.push(s)}return r.sort((function(e,t){return t.volume-e.volume})),(r=r.splice(0,.5*r.length)).sort((function(e,t){return e.position-t.position})),r}([n.getChannelData(0),n.getChannelData(1)]),o=function(e){var t=[];return e.forEach((function(n,r){for(var o=1;r+o<e.length&&o<10;o++){for(var s={tempo:2646e3/(e[r+o].position-n.position),count:1};s.tempo<90;)s.tempo*=2;for(;s.tempo>180;)s.tempo/=2;s.tempo=Math.round(s.tempo),t.some((function(e){return e.tempo===s.tempo?e.count++:0}))||t.push(s)}})),t}(r),s=document.querySelector("#svg");s.innerHTML="";var c,a="http://www.w3.org/2000/svg";r.forEach((function(e){(c=document.createElementNS(a,"rect")).setAttributeNS(null,"x",100*e.position/n.length+"%"),c.setAttributeNS(null,"y",0),c.setAttributeNS(null,"width",1),c.setAttributeNS(null,"height","100%"),s.appendChild(c)})),(c=document.createElementNS(a,"rect")).setAttributeNS(null,"id","progress"),c.setAttributeNS(null,"y",0),c.setAttributeNS(null,"width",1),c.setAttributeNS(null,"height","100%"),s.appendChild(c);var i=o.sort((function(e,t){return t.count-e.count})).splice(0,5);g.getAudioFeaturesForTrack(t.id).then((function(e){p({track:t,top:i,tempo:e.tempo})}))}},r.send()}))},className:"sm:flex my-5 sm:my-10 gap-5",children:[Object(u.jsxs)("div",{className:"w-full",children:[Object(u.jsx)("input",{className:"block w-full p-3 rounded-t-2xl focus:outline-none text-center",name:"song",placeholder:"Type the name of a track (e.g. Beyonce - Baby Boy)"}),Object(u.jsx)("button",{className:"block w-full bg-gray-400 p-3 rounded-b-2xl focus:outline-none",type:"submit",children:"Search track & Calculate tempo"})]}),n&&Object(u.jsx)("div",{className:"flex my-2 sm:m-0 sm:w-2/12 justify-center items-center",children:Object(u.jsx)("button",{onClick:function(){return function(){var e=b.current;m?(h(!1),e.pause()):(h(!0),e.play()),j()}()},className:"flex-1 h-full bg-gray-600 p-2 rounded-2xl focus:outline-none",children:m?"Pause track":"Play track"})})]}),Object(u.jsxs)("div",{children:[Object(u.jsx)("div",{className:"text-center text-gray-900 font-semibold",children:l.track&&Object(u.jsx)(v,{})}),n&&Object(u.jsx)("svg",{className:"w-full bg-gray-500 h-16 my-4",id:"svg"}),Object(u.jsx)("audio",{ref:b,src:n})]})]})},p=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,12)).then((function(t){var n=t.getCLS,r=t.getFID,o=t.getFCP,s=t.getLCP,c=t.getTTFB;n(e),r(e),o(e),s(e),c(e)}))};c.a.render(Object(u.jsx)(o.a.StrictMode,{children:Object(u.jsx)(l,{})}),document.getElementById("root")),p()},9:function(e,t,n){}},[[11,1,2]]]);
//# sourceMappingURL=main.348e451f.chunk.js.map